<!DOCTYPE html>
<html>

<head>
    <title>AR View</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: transparent;
        }
    </style>
</head>

<body>
    <script>
        // Read targets from localStorage
        const defaultTargets = [];
        const storedTargets = localStorage.getItem('arTargets');
        const targets = storedTargets ? JSON.parse(storedTargets) : defaultTargets;

        AFRAME.registerComponent('scene-generator', {
            init: function () {
                const scene = this.el;
                targets.forEach(target => {
                    let marker;
                    if (target.type === 'barcode') {
                        marker = document.createElement('a-marker');
                        marker.setAttribute('type', 'barcode');
                        marker.setAttribute('value', target.value);
                    } else {
                        marker = document.createElement('a-marker');
                        marker.setAttribute('preset', target.type); // e.g., 'hiro'
                    }

                    // Content is always the image from imageSrc
                    if (target.imageSrc) {
                        const contentElement = document.createElement('a-image');
                        contentElement.setAttribute('src', target.imageSrc);
                        contentElement.setAttribute('rotation', '-90 0 0');
                        contentElement.setAttribute('width', '2');
                        contentElement.setAttribute('height', '2');
                        marker.appendChild(contentElement);
                        scene.appendChild(marker);
                    }
                });
            }
        });
    </script>

    <a-scene embedded scene-generator vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; alpha: true; antialias: true;"
        arjs='sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3; sourceWidth:1280; sourceHeight:960; displayWidth: auto; displayHeight: auto;'>

        <a-entity camera></a-entity>

    </a-scene>
</body>

</html>